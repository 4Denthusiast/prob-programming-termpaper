% !TEX root = main.tex
\tikzstyle{termTree}+=
  [root/.style={circle,draw},
  subterm/.style= ,%{draw,regular polygon, regular polygon sides=3, inner sep=1pt},
  branch/.style={inner sep = 0pt},
  graphs/termTree/.style={layered layout, level sep=-1cm, sibling sep=1pt, math nodes},
  every node={node separation=1cm}
  ]
\newsavebox{\termARoot}
\newsavebox{\termALeft}
\newsavebox{\termARight}
\newsavebox{\termAEnd}
\savebox{\termARoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- {"\alpha_1" -- A_1[subterm], "\alpha_2" -- A_2[subterm]}
  };
}
\savebox{\termALeft}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- {"\alpha_1" -- "A_1'"[subterm], "\alpha_2" -- "A_2"[subterm]}
  };
}
\savebox{\termARight}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- {"\alpha_1" -- "A_1"[subterm], "\alpha_2" -- "A_2'"[subterm]}
  };
}
\savebox{\termAEnd}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- {"\alpha_1" -- "A_1'"[subterm], "\alpha_2" -- "A_2'"[subterm]}
  };
}

\newsavebox{\termBRoot}
\newsavebox{\termBRight}
\newsavebox{\termBEnd}
\savebox{\termBRoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- "\alpha" -- "\mathsf{if}" -- {"\underline r", "A"[subterm], "\beta" -- B[subterm]}
  };
}
\savebox{\termBRight}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "\mathsf{if}" -- {"\underline r", A[subterm], "\beta" -- B'[subterm]}
  };
}
\savebox{\termBEnd}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "A"[subterm]
  };
}

\newsavebox{\termCRoot}
\newsavebox{\termCLeft}
\newsavebox{\termCRight}
\newsavebox{\termCEnd}
\savebox{\termCRoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- "\alpha" -- "\mathsf{if}" -- {"\underline r", "A"[subterm], "\beta" -- B[subterm]}
  };
}
\savebox{\termCRight}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "\mathsf{if}" -- {"\underline r", "A"[subterm], "\beta" -- B'[subterm]}
  };
}
\savebox{\termCLeft}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha;\beta" -- "B"[subterm]
  };
}
\savebox{\termCEnd}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha;\beta" -- "B'"[subterm]
  };
}

\newsavebox{\termDRoot}
\newsavebox{\termDLeft}
\newsavebox{\termDRight}
\newsavebox{\termDEnd}
\savebox{\termDRoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- "\alpha" -- "@" -- {"\lambda x" -- "\beta" -- "R"[subterm], "B"[subterm]}
  };
}
\savebox{\termDRight}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "@" -- {"\lambda x" -- "\beta" -- "R'"[subterm], "B"[subterm]}
  };
}
\savebox{\termDLeft}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha;\beta" -- "R[B/x]"[subterm]
  };
}
\savebox{\termDEnd}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha;\beta" -- "R'[B/x]"[subterm]
  };
}

\newsavebox{\termERoot}
\newsavebox{\termELeft}
\newsavebox{\termERight}
\newsavebox{\termEEnd}
\savebox{\termERoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- "\alpha" -- "@" -- {"\lambda x" -- "\dots \gamma_i \dots" -- x[subterm], "\beta" -- "B"[subterm]}
  };
}
\savebox{\termERight}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "@" -- {"\lambda x" -- "\dots \gamma_i \dots" -- x[subterm], "\beta" -- "B'"[subterm]}
  };
}
\savebox{\termELeft}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "\dots \gamma_i \dots" -- "\beta" -- B[subterm]
  };
}
\savebox{\termEEnd}{
  \tikz[termTree] \graph[termTree] {
    ""[root] -- "\alpha" -- "\dots \gamma_i \dots" -- "\beta" -- B'[subterm]
  };
}

\newsavebox{\termFRoot}
\newsavebox{\termFLeftFirst}
\newsavebox{\termFLeftSecond}
\newsavebox{\termFRight}
\newsavebox{\termFEnd}
\savebox{\termFRoot}{
  \tikz[termTree] \graph[termTree] {
    N[root] -- "\alpha" -- "\tY" -- "\lambda x" -- ""[branch] -- {"\dots \gamma_i \dots" -- "x"[subterm], "\beta" -- "C"[subterm]}
  };
}
\savebox{\termFLeftFirst}{
  \tikz[termTree] \graph[termTree, fresh nodes] {
    ""[root] -- "\alpha" -- "\lambda z" -- "@" -- {""[branch] -- {"\dots \gamma_i \dots" -- "\tY" -- "\lambda x" -- "\beta" -- "C"[subterm], "\beta" -- "C[\tY \lambda x A/x]"[subterm]}, "z"}
  };
}
\savebox{\termFLeftSecond}{
  \tikz[termTree] \graph[termTree, fresh nodes] {
    ""[root] -- "\alpha" -- "\lambda z" -- "@" -- {""[branch] -- {"\dots \gamma_i \dots", "\beta" -- "\dots \delta_i \dots"} -- "\tY" -- "\lambda x" -- "\beta" -- "C"[subterm], "z"}
  };
}
\savebox{\termFRight}{
  \tikz[termTree] \graph[termTree, fresh nodes] {
    ""[root] -- "\alpha" -- "\tY" -- "\lambda x" -- ""[branch] -- {"\dots \gamma_i \dots" -- "x"[subterm], "\beta" -- "" -- {"\dots \delta_i \dots" -- "x"[subterm], "C'"[subterm]}}
  };
}
\savebox{\termFEnd}{
  \tikz[termTree] \graph[termTree, fresh nodes] {
    ""[root] -- "\alpha" -- "\lambda z" -- "@" -- {""[branch] -- {"\dots \gamma_i \dots", "\beta" -- "\dots \delta_i \dots"} -- "\tY" -- "\lambda x" -- "\beta" -- "C'"[subterm], "z"}
  };
}

\tikzstyle{reduction sequence} += [
graphs/reduction sequence/.style = {layered layout, level sep = 20pt, sibling sep = 20pt},
  ]

\noindent\makebox[\textwidth]{
    \begin{tikzpicture}[reduction sequence]
      \begin{scope}[xshift=-1cm]
        \graph [reduction sequence] {
          termARoot/\usebox{\termARoot} -> {
            termALeft/\usebox{\termALeft} [> "$\alpha_1$"', < "$\alpha_2$"'],
            termARight/\usebox{\termARight} [> "$\alpha_2$", < "$\alpha_1$"]
          } ->
          termAEnd/\usebox{\termAEnd}
        };
        \node at (termARoot.north) [above=5mm] {a};
      \end{scope}

      \begin{scope}[xshift=5cm]
        \graph [reduction sequence] {
          termBRoot/\usebox{\termBRoot} ->["$\alpha;\textsf{if}_3;\beta$"']
          termBRight/\usebox{\termBRight} ->["$\alpha$"']
          termBEnd/\usebox{\termBEnd},
          termBRoot ->["$\alpha$"] termBEnd
        };
        \node at (termBRoot.north) [above=5mm] {b};
      \end{scope}

      \begin{scope}[xshift=9cm]
        \graph [reduction sequence] {
          termCRoot/\usebox{\termCRoot} -> {
            termCLeft/\usebox{\termCLeft} [> "$\alpha$"', < "$\alpha;\beta$"'],
            termCRight/\usebox{\termCRight} [> "$\alpha;\textsf{if}_3;\beta$", < "$\alpha$"]
          } ->
          termCEnd/\usebox{\termCEnd}
        };
        \node at (termCRoot.north) [above=5mm] {c};
      \end{scope}
    \end{tikzpicture}
}

\noindent\makebox[\textwidth]{
    \begin{tikzpicture}[reduction sequence]
      \graph [reduction sequence] {
        termDRoot/\usebox{\termDRoot} -> {
          termDLeft/\usebox{\termDLeft} [> "$\alpha$", < "$\alpha;\beta$"],
          termDRight/\usebox{\termDRight} [> "$\alpha;@_1;\lambda;\beta$", < "$\alpha$"]
        } ->
        termDEnd/\usebox{\termDEnd}
      };
      \node at (termDRoot.north) [above=5mm] {d};

      \begin{scope}[xshift=8cm]
        \graph [reduction sequence] {
          termERoot/\usebox{\termERoot} -> {
            termELeft/\usebox{\termELeft} [> "$\alpha$"', < "$(\alpha;\gamma_i;\beta)_i$"', < dashed],
            termERight/\usebox{\termERight} [> "$\alpha;@_2;\beta$", < "$\alpha$"]
          } ->
          termEEnd/\usebox{\termEEnd}
        };
        \node at (termERoot.north) [above=5mm] {e};
      \end{scope}
    \end{tikzpicture}
}

\noindent\makebox[\textwidth]{
    \begin{tikzpicture}[reduction sequence]
      \node (termFRoot) at (0,0) {\usebox{\termFRoot}};
      \node (termFLeft1) at (-6,-5) {\usebox{\termFLeftFirst}};
      \node (termFLeft2) at (-2,-12) {\usebox{\termFLeftSecond}};
      \node (termFRight) at (6,-1) {\usebox{\termFRight}};
      \node (termFEnd) at (4,-13) {\usebox{\termFEnd}};
      \graph {
        (termFRoot) ->["$\alpha$"']
        (termFLeft1) ->["$\alpha;\lambda;@_1;\beta$"']
        (termFLeft2) ->[dashed]
        (termFEnd),
        
        (termFRoot) ->["$\alpha;\tY;\lambda;\beta$"]
        (termFRight) ->["$\alpha$"]
        (termFEnd)
      };
      \node at (1,-13.3) [align=center] {$(\alpha;\lambda;@_1;\gamma_i;\tY;\lambda;\beta)_i$ \\ $(\alpha;\lambda;@_1;\beta;\delta_i;\tY;\lambda;\beta)_i$};
      \node at (termFRoot.north) [above=5mm] {f};
    \end{tikzpicture}
}
